# Лабораторная работа №2: временные ряды

## Внимание: 
### 1.Условие работы будет дополнено
### 2.Данные для работы будут обновлены за день до срока сдачи
### 3.Будет добавлен Jupyter-нотебук с примером записи прогнозов в файл.

В данной лабораторной работе нужно будет научиться работать с временными рядами. Данные представляют собой курс иностранной валюты (евро) за последние несколько лет. Ваша задача проанализировать эти данные и научиться прогнозировать
будущие значения.
 
Метрика качества — `Meab Absolute Error`.

Установите библиотеку для работы с временными рядами: [Statsmodels](https://www.statsmodels.org/stable/index.html).

Скачайте [архив с данными](https://drive.google.com/file/d/1fdjCswQ64LnhdNPiATE5HbmSZuKDsCSf/view?usp=sharing).

Максимальная оценка за работу без задания повышенной сложности — `8`.


### 1. Разведочный анализ данных

1. Загрузите данные.
2. Используя метод скользящего среднего, сгладьте временной ряд. Ширину окна выбирайте равной одной недели, месяцу, кварталу.
3. На одной графике изобразите исходный временной ряд, а также его сглаженные версии. Есть ли у ряда тренд, сезонность?
4. Является ли заданный временной ряд стационарным? Почему? Проверьте своё предположение с помощью теста [Дики-Фуллера](https://ru.wikipedia.org/wiki/Тест_Дики_—_Фуллера).


### 2. Кросс-валидация

Реализуйте функцию `cross_val_on_time_series`, которая разбивает обучающие данные на группы, затем для каждой из них обучает переданный регрессор, 
предсказывает значения для тестовых данных и возвращает список из значений по целевой метрики для пресказанных и реальных значений.

Функция должна иметь следующие входные параметры: 

1. `regressor` — регрессор, для которого реализованы методы `fit` и `predict`
2. `X` — матрица признаков для примеров (упорядоченных по времени)
3. `y` — значения целевой переменной (упорядоченные по времени)
4. `n_splits` — количество разбиений для временного ряда
5. `metric` — целевая метрика (см. `sklearn.metrics`, а также услвоие лабораторной работы)

Примечание: для разбиения данных на группы рекомендуется использовать `TimeSeriesSplit` из `sklearn.model_selection`.


### 3. Прогнозирование с использованием матрицы признаков

1. Напишите функцию `create_time_series_features`, которая создает матрицу признаков для переданного временного
ряда на основе времени наблюдения целевой переменной.
2. Создайте матрицу признаков для заданного временного ряда.
3. Сравните производительность следующих алгоритмов, используя кросс-валидацию 
(подумайте нужно ли использовать функцию из предыдущего задания):

* `SGDRegressor`
* `LinearRegression`
* `RandomForestRegressor`
* `XGBRegressor/LGBMRegressor`

4. Обучите бустинг-модель и постройте график важности признаков (`feature_importances`).
5. Разбейте временной ряд на тренировочный и тестовый в соотношении 9:1, обучите по одной линейной и древесной модели, которые показали 
себя лучше всего в 3-м пункте, и спрогнозируйте значения для тестовых данных. 
6. На одном графике изобразите исходный временной ряд и предсказанные значения для тестовых данных из предыдущего пункта. 
Используйте разные цвета для предсказаний и истинных значений.
7. Попробуйте улучшить работу алгоритмов, подбирая параметры моделей или изменяя исходный ряд, например, при помощи 
[преобразования Бокса-Кокса](http://www.machinelearning.ru/wiki/index.php?title=Метод_Бокса-Кокса).


### 4. Авторегрессия

1. Построейте модель авторегресии и используя результаты 3-го задания оцените работу алгоритма на кросс-валидации.
2. Удалите из ряда тренд и вновь проведите кросс-валидацию модели. Прокомментируйте результаты, сравните их с теми, что получены во 2-м
пункте лабораторной.

Примечание: тренд можно удалять явно, обучая функцию от времени, например, линейную квадратичную и т.д., или дифференцируя исходный ряд 
(в этом случае подумайте, как строить прогноз для исходного ряда).

3. Действую по аналогии с пунктом 6 задания 3, предскажите значения для тестового временного промежутка и добавьте их на график с 
другими моделями.
4. Попробуйте улучшить качество модели.
  

### 5. *SARIMA  

1. Постройте модель SARIMA и подберите её параметры (например, основываясь на 
[AIC](https://ru.wikipedia.org/wiki/Информационный_критерий_Акаике)- информационном критерии Акаике).
2. Оцените качество построенной модели.
3. По аналогии с предыдущими пунктами сравните результаты разных моделей, постройте совместный график для предсказаний на последней части 
временного ряда.


### 6. Построение прогнозов

1. Используя результаты предыдущих пунктов, предскажите значения временного ряда на период с `28.10.2019` по `11.11.2019`. 
2. Сохраните результат в файле `submission_ФамилияИмя.csv` и отправьте отчет преподавателю.


__Ваша итоговая оценка будет зависеть от качества построенных прогнозов. Также имейте ввиду, что для работ не сданных в срок, 
оценка за предсказания может быть уменьшена до 0, поскольку у вас будет доступ к значениям целевой переменной, что даст возможность
подстроить под них модель.__


## Перед выполнением работы рекомендуется ознакомиться со следующими материалами:
1. [Анализ временных рядов с помощью Python](https://habr.com/ru/company/ods/blog/327242/)
2. ...

__Срок сдачи работы: `27 октября 2019`.__
